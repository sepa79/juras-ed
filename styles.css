:root{
  --bg:#0f1115;
  --panel:#151924;
  --card:#1a2030;
  --text:#e7ecff;
  --muted:#a8b0d0;
  --border:#27304a;
  --accent:#6aa1ff;
  --accent-glow: rgba(106,161,255,.35);
  --danger:#ff5a6a;
  --topbar-h:58px;
  --statusbar-h:74px;
  --thumb-bg:#203040;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);
  color:var(--text);
}

/* Scrollbars */
*{
  scrollbar-width: thin;
  scrollbar-color: rgba(167,176,208,.55) rgba(0,0,0,0);
}
*::-webkit-scrollbar{width:10px; height:10px}
*::-webkit-scrollbar-track{background: rgba(0,0,0,0)}
*::-webkit-scrollbar-thumb{
  background: rgba(167,176,208,.28);
  border-radius:999px;
  border:2px solid rgba(0,0,0,0);
  background-clip: padding-box;
}
*::-webkit-scrollbar-thumb:hover{background: rgba(167,176,208,.38); background-clip: padding-box}
*::-webkit-scrollbar-corner{background: rgba(0,0,0,0)}

html[data-theme^="dark"]{
  --bg:#07080b;
  --panel:#0b0d14;
  --card:#0c101a;
  --text:#ffe9e9;
  --muted:#d2a5a5;
  --border:#2a0f14;
  --accent:#ff2d2d;
  --accent-glow: rgba(255,45,45,.35);
  --danger:#ff2d2d;
}

@keyframes accentPulse{
  0%,100%{
    box-shadow: 0 0 0 2px var(--accent), 0 0 0 1px rgba(0,0,0,.25) inset, 0 0 10px var(--accent-glow);
  }
  50%{
    box-shadow: 0 0 0 3px var(--accent), 0 0 0 1px rgba(0,0,0,.25) inset, 0 0 16px var(--accent-glow);
  }
}
@media (prefers-reduced-motion: reduce){
  .slotBtn[aria-pressed="true"],
  .swatch[aria-checked="true"]{
    animation: none !important;
  }
}

html[data-theme^="dark"] .panel{
  background: rgba(11,13,20,.32);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
html[data-theme^="dark"] .card{
  background: rgba(12,16,26,.34);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
html[data-theme^="dark"] .statuscard{
  background: rgba(12,16,26,.36);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
html[data-theme^="dark"] body{
  background: radial-gradient(1200px 700px at 50% 40%, rgba(255,45,45,.06), rgba(0,0,0,0) 60%),
              rgba(7,8,11,.92);
}
html[data-theme^="dark"] .btn{
  background: rgba(15,20,33,.62);
}
html[data-theme^="dark"] .field__input{
  background: rgba(15,20,33,.62);
}
html[data-theme^="dark"] *{
  scrollbar-color: rgba(255,45,45,.55) rgba(0,0,0,0);
}
html[data-theme^="dark"] *::-webkit-scrollbar-thumb{
  background: rgba(255,45,45,.22);
  border-radius:999px;
  border:2px solid rgba(0,0,0,0);
  background-clip: padding-box;
}
html[data-theme^="dark"] *::-webkit-scrollbar-thumb:hover{background: rgba(255,45,45,.32); background-clip: padding-box}

.topbar{
  display:flex;
  gap:16px;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
}
.topbar__center{
  position:absolute;
  left:50%;
  transform: translateX(-50%);
  display:flex;
  gap:10px;
  align-items:center;
}
@media (max-width: 980px){
  .topbar__center{position:static; transform:none}
  .topbar{flex-wrap:wrap}
}
.brand__title{
  font-weight:700;
  letter-spacing:.2px;
  display:flex;
  align-items:center;
  gap:10px;
}
.brand__icon{
  width:22px;
  height:22px;
  border-radius:6px;
  image-rendering: pixelated;
}
.brand__motto{
  margin-left:6px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  font-size:12px;
  color: var(--muted);
  white-space:nowrap;
}
.brand__subtitle{color:var(--muted); font-size:12px; margin-top:2px}
.topbarInput{
  height:34px;
  padding:0 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  color: var(--text);
  outline:none;
  min-width: 160px;
  width: min(260px, 34vw);
}
.topbarInput::placeholder{color: rgba(168,176,208,.85)}
.topbarInput:focus-visible{
  outline:2px solid rgba(106,161,255,.55);
  outline-offset:2px;
}
html[data-theme^="dark"] .topbarInput{
  background: rgba(15,20,33,.62);
  border-color: rgba(255,45,45,.32);
}
html[data-theme^="dark"] .topbarInput::placeholder{color: rgba(210,165,165,.85)}
html[data-theme^="dark"] .topbarInput:focus-visible{
  outline:2px solid rgba(255,45,45,.55);
}
.topbar__actions{display:flex; gap:10px; align-items:center}
.ioIcon{display:inline-flex; align-items:center; gap:6px}
.ioIcon svg{width:14px; height:14px; display:block; opacity:.95}
.ioText{font-weight:800; letter-spacing:.06em}
.themeDot{
  width:10px;
  height:10px;
  border-radius:999px;
  display:inline-block;
  background: var(--accent);
  box-shadow: 0 0 0 2px rgba(0,0,0,.25);
}
.themeText{font-weight:600}

.layout{
  display:grid;
  grid-template-columns: 360px 1fr 320px;
  min-height: calc(100vh - var(--topbar-h) - var(--statusbar-h));
  height: calc(100vh - var(--topbar-h) - var(--statusbar-h));
  overflow:hidden;
}
.panel{
  padding:14px 14px calc(14px + var(--statusbar-h));
  border-right:1px solid var(--border);
  background:var(--panel);
  overflow:auto;
}
.panel--right{
  border-right:none;
  border-left:1px solid var(--border);
  height: 100%;
}
.stage{
  padding:18px 18px calc(18px + var(--statusbar-h));
  display:flex;
  align-items:flex-start;
  justify-content:center;
  overflow:auto;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
}
.card__head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.card__title{
  margin:0;
  font-size:13px;
  color:var(--muted);
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.08em;
}

.palette{
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  gap:8px;
}
.colorSlots{
  display:flex;
  flex-wrap:nowrap;
  gap:8px;
  margin-bottom:10px;
  min-width:0;
}
.slotBtn{
  height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0 10px;
  gap:10px;
  flex: 1 1 0;
  min-width:52px;
}
.slotBtn[aria-pressed="true"]{
  border-color: var(--accent);
  box-shadow: 0 0 0 2px var(--accent), 0 0 0 1px rgba(0,0,0,.25) inset, 0 0 10px var(--accent-glow);
  animation: accentPulse 1.35s ease-in-out infinite;
}
.slotLbl{font-size:12px; font-weight:900; color:inherit; letter-spacing:.08em; text-shadow: 0 1px 0 rgba(0,0,0,.35)}
.slotSwatch{
  display:none;
}
.swatch{
  width:100%;
  aspect-ratio: 1 / 1;
  border-radius:10px;
  padding:0;
  min-width:0;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 0 0 1px rgba(0,0,0,.2) inset;
  cursor:pointer;
  position:relative;
  outline:none;
}
.swatch[aria-checked="true"]{
  box-shadow: 0 0 0 2px var(--accent), 0 0 0 1px rgba(0,0,0,.25) inset, 0 0 10px var(--accent-glow);
  animation: accentPulse 1.35s ease-in-out infinite;
  border-color: rgba(255,255,255,.28);
}

.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px}
.grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.tools{display:grid; grid-template-columns: 1fr; gap:8px}
.field{display:flex; flex-direction:column; gap:6px}
.field__label{font-size:12px; color:var(--muted)}
.field__input{
  height:34px;
  padding:0 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  color:var(--text);
}
.field__input--color{
  padding:0;
  height:34px;
}
.toggle{
  display:flex;
  gap:10px;
  align-items:center;
  user-select:none;
  cursor:pointer;
  position:relative;
}
.toggle input{
  position:absolute;
  opacity:0;
  pointer-events:none;
}
.toggleBox{
  width:18px;
  height:18px;
  border-radius:8px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.04);
  display:inline-block;
  position:relative;
  flex:0 0 auto;
}
.toggle input:checked + .toggleBox{
  background: rgba(106,161,255,.22);
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.20) inset;
}
.toggleBox::after{
  content:"";
  position:absolute;
  inset:0;
  background: currentColor;
  clip-path: polygon(20% 55%, 38% 72%, 78% 28%, 86% 36%, 38% 82%, 14% 58%);
  color: rgba(255,255,255,.95);
  opacity:0;
}
.toggle input:checked + .toggleBox::after{opacity:1}
.toggle input:focus-visible + .toggleBox{
  outline: 2px solid rgba(106,161,255,.55);
  outline-offset: 2px;
}
.toggleText{font-size:13px; font-weight:600}
.toggleBtn{
  height:40px;
  padding:0 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  width:100%;
}
.toggleBtn:hover{border-color:#3a4770}
.toggleBtn .toggleText{font-weight:600}
.toggleBtn .toggleBox{margin-right:2px}

html[data-theme^="dark"] .toggleBox{
  background: rgba(255,45,45,.06);
  border-color: rgba(255,45,45,.32);
}
html[data-theme^="dark"] .toggle input:checked + .toggleBox{
  background: rgba(255,45,45,.18);
  border-color: rgba(255,45,45,.55);
  box-shadow: 0 0 0 1px rgba(255,45,45,.20) inset;
}
html[data-theme^="dark"] .toggle input:focus-visible + .toggleBox{
  outline: 2px solid rgba(255,45,45,.55);
}
.hint{font-size:12px; color:var(--muted)}
.status{margin-top:10px; font-size:12px; color:var(--muted)}

.btn{
  height:34px;
  padding:0 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  color:var(--text);
  cursor:pointer;
  min-width:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}

.layerRow{gap:8px}
.segBtn{
  flex: 1 1 auto;
  height: 34px;
  padding: 0 10px;
}
.segBtn[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.20) inset;
  background: linear-gradient(180deg, rgba(106,161,255,.20), rgba(106,161,255,.06));
}
html[data-theme^="dark"] .segBtn[aria-pressed="true"]{
  border-color: rgba(255,45,45,.55);
  box-shadow: 0 0 0 1px rgba(255,45,45,.20) inset;
  background: linear-gradient(180deg, rgba(255,45,45,.16), rgba(255,45,45,.05));
}
.btn:hover{border-color:#3a4770}
.btn:active{transform: translateY(1px)}
.btn[disabled]{opacity:.55; cursor:not-allowed}
.srOnly{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip: rect(0, 0, 0, 0);
  white-space:nowrap;
  border:0;
}
.toolBtn[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.toolBtn{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:10px;
  padding:0 12px;
  height:40px;
}
.toolIcon{
  width:18px;
  height:18px;
  color: var(--text);
}
.toolText{
  font-size:13px;
  font-weight:600;
  letter-spacing:.2px;
}

.library{
  margin-top:10px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap:10px;
}
.libItem{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  border:1px solid var(--border);
  border-radius:12px;
  background:#0f1421;
  cursor:pointer;
  overflow:hidden;
}
.libItem:hover{border-color:#3a4770}
.libItem[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.libThumb{
  width:100%;
  height:84px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.12);
  background: repeating-conic-gradient(rgba(255,255,255,.06) 0 25%, rgba(255,255,255,0) 0 50%) 50% / 16px 16px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.library--sprites .libThumb{
  background: var(--thumb-bg);
}
.library--sprites .libThumb canvas,
.spriteInspector__preview canvas,
.layerRowThumb canvas{
  background: var(--thumb-bg);
}
.libThumb canvas{
  width:100%;
  height:100%;
  object-fit: contain;
  image-rendering: pixelated;
  border-radius:10px;
}

.library--sprites .libItem--active{
  grid-column: 1 / -1;
}
.library--sprites .libItem--active .libThumb{
  height:140px;
}

.spriteInspector{
  margin-top:10px;
  padding:10px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.03);
  border-radius:14px;
  color: var(--text);
}
html[data-theme^="dark"] .spriteInspector{
  background: rgba(0,0,0,.10);
  border-color: rgba(255,45,45,.26);
  border-radius:0;
}
.spriteInspector__top{display:flex; gap:10px; align-items:stretch}
.spriteInspector__preview{
  width:120px;
  height:120px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background: var(--thumb-bg);
  overflow:hidden;
  flex:0 0 auto;
}
html[data-theme^="dark"] .spriteInspector__preview{border-radius:0}
.spriteInspector__preview canvas{
  width:100%;
  height:100%;
  image-rendering: pixelated;
  display:block;
}
.spriteInspector__meta{display:flex; flex-direction:column; gap:8px; min-width:0; flex:1}
.spriteInspector__name{
  height:32px;
  padding:0 10px;
  border-radius:12px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.04);
  color: var(--text);
  font-size:13px;
  font-weight:800;
  outline:none;
}
html[data-theme^="dark"] .spriteInspector__name{border-radius:0; border-color: rgba(255,45,45,.32); background: rgba(0,0,0,.14)}
.spriteInspector__modes{display:flex; gap:8px; flex-wrap:wrap}
.spriteInspector__actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.spriteInspector__layers{margin-top:10px; display:flex; flex-direction:column; gap:8px}
.layerRowItem{
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px;
  border:1px solid rgba(255,255,255,.10);
  border-radius:12px;
  background: rgba(15,20,33,.42);
  cursor:pointer;
  color: var(--text);
}
html[data-theme^="dark"] .layerRowItem{border-radius:0; border-color: rgba(255,45,45,.22); background: rgba(0,0,0,.10)}
.layerRowItem[aria-disabled="true"]{opacity:.45; cursor:not-allowed}
.layerRowItem[aria-pressed="true"]{border-color: rgba(106,161,255,.55); box-shadow: 0 0 0 1px rgba(106,161,255,.18) inset}
html[data-theme^="dark"] .layerRowItem[aria-pressed="true"]{border-color: rgba(255,45,45,.55); box-shadow: 0 0 0 1px rgba(255,45,45,.18) inset}
.layerRowThumb{
  width:44px;
  height:44px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.12);
  background: var(--thumb-bg);
  overflow:hidden;
  flex:0 0 auto;
}
html[data-theme^="dark"] .layerRowThumb{border-radius:0}
.layerRowThumb canvas{width:100%; height:100%; image-rendering: pixelated; display:block}
.layerRowLabel{font-size:12px; font-weight:800; min-width:0; color: var(--text)}
.layerRowHint{font-size:11px; color: var(--muted); min-width:0}
.layerRowGrow{display:flex; flex-direction:column; gap:2px; min-width:0; flex:1}
.layerVisBtn{width:32px; height:32px}
.libRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  min-width:0;
}
.libMeta{
  font-size:11px;
  color:var(--muted);
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.layerBadges{display:flex; gap:6px; align-items:center; flex-wrap:wrap; flex:0 0 auto}
.layerBadge{
  font-size:11px;
  padding:2px 6px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(10,20,40,.22);
  border-radius:8px;
  color: var(--muted);
  line-height: 1.3;
  white-space:nowrap;
}
.layerBadge--on{color: var(--text); border-color: rgba(106,161,255,.22); background: rgba(106,161,255,.12)}
.layerBadge--dim{opacity:.45}
.libNameInput{
  width:100%;
  min-width:0;
  height:28px;
  padding:0 8px;
  border-radius:10px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.04);
  color: var(--text);
  font-size:12px;
  font-weight:700;
  outline:none;
}
.libNameInput:focus-visible{
  outline:2px solid rgba(106,161,255,.55);
  outline-offset:2px;
}
html[data-theme^="dark"] .libNameInput{
  background: rgba(12,16,26,.18);
  border-color: rgba(255,45,45,.32);
}
html[data-theme^="dark"] .libNameInput:focus-visible{
  outline:2px solid rgba(255,45,45,.55);
}
.libActions{display:flex; gap:8px; align-items:center; flex:0 0 auto}
.iconBtn{
  width:32px;
  height:32px;
  border-radius:10px;
  border:1px solid var(--border);
  background: rgba(15,20,33,.88);
  color: var(--text);
  cursor:pointer;
}
.iconBtn:hover{border-color:#3a4770}
.iconBtn svg{width:16px; height:16px; display:block; margin:0 auto; color:var(--text)}
.collapseBtn svg{transition: transform .12s ease}
.collapseBtn[aria-expanded="false"] svg{transform: rotate(-90deg)}
.btn--primary{
  background: linear-gradient(180deg, rgba(106,161,255,.24), rgba(106,161,255,.06));
  border-color: rgba(106,161,255,.35);
}
.btn--danger{
  background: linear-gradient(180deg, rgba(255,90,106,.18), rgba(255,90,106,.05));
  border-color: rgba(255,90,106,.35);
}

.canvasWrap{
  display:inline-block;
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  background:#0b0e16;
  outline:none;
  position:relative;
}

html[data-theme="dark-hell"] .canvasWrap,
html[data-theme="dark-candles"] .canvasWrap{
  cursor: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2032%2032%22%3E%3Cg%20transform%3D%22rotate(180%2016%2016)%22%3E%3Cpath%20d%3D%22M16%204%20L23%2026%20L5.8%2012.5%20L26.2%2012.5%20L9%2026%20Z%22%20fill%3D%22none%22%20stroke%3D%22%23ff2d2d%22%20stroke-width%3D%221.8%22%20stroke-linejoin%3D%22round%22%2F%3E%3Ccircle%20cx%3D%2216%22%20cy%3D%2216%22%20r%3D%222%22%20fill%3D%22%23ff2d2d%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E") 16 16, crosshair;
}
html[data-theme="dark-hell"] #canvas,
html[data-theme="dark-candles"] #canvas{
  cursor: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2032%2032%22%3E%3Cg%20transform%3D%22rotate(180%2016%2016)%22%3E%3Cpath%20d%3D%22M16%204%20L23%2026%20L5.8%2012.5%20L26.2%2012.5%20L9%2026%20Z%22%20fill%3D%22none%22%20stroke%3D%22%23ff2d2d%22%20stroke-width%3D%221.8%22%20stroke-linejoin%3D%22round%22%2F%3E%3Ccircle%20cx%3D%2216%22%20cy%3D%2216%22%20r%3D%222%22%20fill%3D%22%23ff2d2d%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E") 16 16, crosshair;
}

html[data-theme="dark-hell"],
html[data-theme="dark-candles"]{
  cursor: none;
}

/* Show system cursor on UI elements (dark themes hide cursor globally). */
html[data-theme^="dark"] .topbar,
html[data-theme^="dark"] .panel,
html[data-theme^="dark"] .card,
html[data-theme^="dark"] .statusbar,
html[data-theme^="dark"] .statuscard,
html[data-theme^="dark"] .modal,
html[data-theme^="dark"] .modal__card{
  cursor: auto;
}
html[data-theme^="dark"] input,
html[data-theme^="dark"] textarea{
  cursor: text;
}

/* Evil cursor: single, lightly rotating flame (only outside the editor canvas). */
#evilCursor{
  position: fixed;
  left: 0;
  top: 0;
  width: 22px;
  height: 22px;
  transform: translate3d(-9999px, -9999px, 0) translate(-50%,-50%);
  pointer-events: none;
  z-index: 9999;
  display: none;
  will-change: transform, opacity;
  opacity: 0;
  filter: drop-shadow(0 0 6px rgba(255, 90, 30, .18)) drop-shadow(0 0 12px rgba(255, 45, 45, .10));
}
#evilCursor .evilCursor__icon{
  width: 22px;
  height: 22px;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  animation: evilCursorWobble 700ms steps(2, end) infinite;
  transform-origin: 50% 50%;
}
@keyframes evilCursorWobble{
  0%{ transform: translateY(0) rotate(-6deg) scale(1); opacity: .95 }
  50%{ transform: translateY(-1px) rotate(7deg) scale(1.06); opacity: 1 }
  100%{ transform: translateY(0) rotate(-6deg) scale(1); opacity: .95 }
}
html[data-theme="dark-hell"] #evilCursor,
html[data-theme="dark-candles"] #evilCursor{display:block}

html[data-theme^="dark"] .canvasWrap{
  background: rgba(11,14,22,.18);
  border-color: rgba(255,45,45,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.canvasWrap:focus{
  box-shadow: 0 0 0 2px rgba(106,161,255,.35);
}
canvas{
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  display:block;
  border-radius:10px;
}

.overlay{
  position:absolute;
  inset: 14px;
  pointer-events:none;
}
.overlayBar{
  position:absolute;
  display:flex;
  gap:8px;
  pointer-events:auto;
}
.overlayBar--top{left:50%; top:-10px; transform:translate(-50%,-100%)}
.overlayBar--bottom{left:50%; bottom:-10px; transform:translate(-50%,100%)}
.overlayBar--left{left:-10px; top:50%; transform:translate(-100%,-50%); flex-direction:column}
.overlayBar--right{right:-10px; top:50%; transform:translate(100%,-50%); flex-direction:column}
.overlayBtn{
  width:34px;
  height:34px;
  border-radius:10px;
  border:1px solid var(--border);
  background: rgba(15,20,33,.88);
  color: var(--text);
  cursor:pointer;
}
.overlayBtn:hover{border-color:#3a4770}
.overlayBtn[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.overlayBtn svg{width:18px; height:18px; display:block; margin:0 auto; color:var(--text)}

.statusbar{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height: var(--statusbar-h);
  padding:10px 12px;
  border-top:1px solid var(--border);
  background: linear-gradient(180deg, rgba(15,17,21,0), rgba(15,17,21,.92) 30%, rgba(15,17,21,.98));
  backdrop-filter: blur(10px);
}
.statuscard{
  max-width: 1200px;
  margin: 0 auto;
  border:1px solid var(--border);
  border-radius:12px;
  background: rgba(26,32,48,.78);
}
.statusgrid{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:8px;
  padding:10px;
}
.kv{display:flex; flex-direction:column; gap:4px; min-width:0}
.k{font-size:11px; letter-spacing:.06em; text-transform:uppercase; color:var(--muted)}
.v{font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

@media (max-width: 980px){
  .layout{grid-template-columns:1fr}
  .panel{border-right:none; border-bottom:1px solid var(--border)}
  .panel--right{border-left:none; height:auto; overflow:visible}
  .statusgrid{grid-template-columns: 1fr 1fr}
}

/* Evil theme background */
.evilLayer{
  display:none;
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  overflow:hidden;
}
html[data-theme="dark-hell"] .evilLayer,
html[data-theme="dark-candles"] .evilLayer{display:block}
.evilCanvas{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:0;
  opacity:.90;
  mix-blend-mode: normal;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}

html[data-theme="dark-hell"] body::before,
html[data-theme="dark-candles"] body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  background: radial-gradient(1200px 700px at 50% 40%, rgba(255,45,45,.12), rgba(0,0,0,0) 60%),
              radial-gradient(900px 520px at 20% 10%, rgba(255,45,45,.06), rgba(0,0,0,0) 60%);
}
.topbar,.layout{position:relative; z-index:1}
.statusbar{z-index:2}

html[data-theme^="dark"] .card{
  background: rgba(12,16,26,.30) !important;
}
html[data-theme^="dark"] .statuscard{
  background: rgba(12,16,26,.30) !important;
}
html[data-theme^="dark"] .statusgrid{
  background: rgba(0,0,0,0);
}
html[data-theme^="dark"] .statusbar{
  background: linear-gradient(180deg, rgba(7,8,11,0), rgba(7,8,11,.45) 30%, rgba(7,8,11,.55));
}

/* Dark theme: kanciasty (bez zaokrągleń) */
html[data-theme^="dark"] .card,
html[data-theme^="dark"] .statuscard,
html[data-theme^="dark"] .canvasWrap,
html[data-theme^="dark"] canvas,
html[data-theme^="dark"] .btn,
html[data-theme^="dark"] .iconBtn,
html[data-theme^="dark"] .overlayBtn,
html[data-theme^="dark"] .swatch,
html[data-theme^="dark"] .slotBtn,
html[data-theme^="dark"] .slotSwatch,
html[data-theme^="dark"] .toggleBox,
html[data-theme^="dark"] .libItem,
html[data-theme^="dark"] .libThumb,
html[data-theme^="dark"] .field__input,
html[data-theme^="dark"] .brand__icon,
html[data-theme^="dark"] .topbarInput,
html[data-theme^="dark"] .brand__motto{
  border-radius: 0 !important;
}

/* Help modal */
.modal{
  position:fixed;
  inset:0;
  z-index: 50;
  display:grid;
  place-items:center;
  padding:18px;
}
.modal[hidden]{display:none}
.modal__backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.55);
}
.modal__card{
  position:relative;
  width: min(980px, 92vw);
  max-height: min(82vh, 760px);
  border:1px solid var(--border);
  border-radius:12px;
  background: rgba(26,32,48,.92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.modal__card--sm{
  width: min(560px, 92vw);
  max-height: min(70vh, 520px);
}
.modal__card--md{
  width: min(720px, 92vw);
  max-height: min(80vh, 620px);
}
html[data-theme^="dark"] .modal__card{
  background: rgba(12,16,26,.62);
}
.modal__head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
}
.modal__title{font-weight:800; letter-spacing:.2px}
.modal__body{
  padding:12px;
  overflow:auto;
}
.keysContent{
  line-height:1.35;
  font-size:13px;
  color: var(--text);
}
.keysContent h3{
  margin: 10px 0 6px;
  font-size: 12px;
  letter-spacing:.06em;
  text-transform: uppercase;
  color: var(--muted);
}
.keysContent ul{margin:0 0 10px 18px; padding:0}
.keysContent li{margin:3px 0}
.keysContent kbd{
  display:inline-block;
  padding:2px 6px;
  border-radius:8px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.06);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12px;
}
html[data-theme^="dark"] .keysContent kbd{
  border-radius: 0;
  border-color: rgba(255,45,45,.32);
  background: rgba(12,16,26,.22);
}

.ioList{display:grid; grid-template-columns: 1fr; gap:8px; margin-top:10px}
.ioGroup{margin-top:8px; padding:6px 6px 2px; font-size:12px; font-weight:900; letter-spacing:.12em; text-transform:uppercase; color: var(--muted)}
.ioGroup:first-child{margin-top:0}
.ioItem{display:flex; flex-direction:column; align-items:flex-start; text-align:left; padding:10px 12px}
.ioItem__title{font-weight:900; letter-spacing:.2px}
.ioItem__sub{margin-top:2px; font-size:12px; color: var(--muted)}
html[data-theme^="dark"] .ioItem__sub{color: rgba(255,215,215,.72)}
.modal__actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:12px;
}
.confirmMsg{
  color: var(--text);
  line-height: 1.35;
  font-size: 13px;
}
.helpText{
  margin:0;
  white-space:pre-wrap;
  line-height:1.35;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12.5px;
  color: var(--text);
}
.library--sprites{
  grid-template-columns: repeat(3, minmax(0, 1fr));
}
