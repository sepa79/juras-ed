:root{
  --bg:#0f1115;
  --panel:#151924;
  --card:#1a2030;
  --text:#e7ecff;
  --muted:#a8b0d0;
  --border:#27304a;
  --accent:#6aa1ff;
  --danger:#ff5a6a;
  --topbar-h:58px;
  --statusbar-h:74px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--bg);
  color:var(--text);
}

/* Scrollbars */
*{
  scrollbar-width: thin;
  scrollbar-color: rgba(167,176,208,.55) rgba(0,0,0,0);
}
*::-webkit-scrollbar{width:10px; height:10px}
*::-webkit-scrollbar-track{background: rgba(0,0,0,0)}
*::-webkit-scrollbar-thumb{
  background: rgba(167,176,208,.28);
  border-radius:999px;
  border:2px solid rgba(0,0,0,0);
  background-clip: padding-box;
}
*::-webkit-scrollbar-thumb:hover{background: rgba(167,176,208,.38); background-clip: padding-box}
*::-webkit-scrollbar-corner{background: rgba(0,0,0,0)}

html[data-theme="dark"]{
  --bg:#07080b;
  --panel:#0b0d14;
  --card:#0c101a;
  --text:#ffe9e9;
  --muted:#d2a5a5;
  --border:#2a0f14;
  --accent:#ff2d2d;
  --danger:#ff2d2d;
}

html[data-theme="dark"] .panel{
  background: rgba(11,13,20,.32);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
html[data-theme="dark"] .card{
  background: rgba(12,16,26,.34);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
html[data-theme="dark"] .statuscard{
  background: rgba(12,16,26,.36);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
html[data-theme="dark"] body{
  background: radial-gradient(1200px 700px at 50% 40%, rgba(255,45,45,.06), rgba(0,0,0,0) 60%),
              rgba(7,8,11,.92);
}
html[data-theme="dark"] .btn{
  background: rgba(15,20,33,.62);
}
html[data-theme="dark"] .field__input{
  background: rgba(15,20,33,.62);
}
html[data-theme="dark"] *{
  scrollbar-color: rgba(255,45,45,.55) rgba(0,0,0,0);
}
html[data-theme="dark"] *::-webkit-scrollbar-thumb{
  background: rgba(255,45,45,.22);
  border-radius:999px;
  border:2px solid rgba(0,0,0,0);
  background-clip: padding-box;
}
html[data-theme="dark"] *::-webkit-scrollbar-thumb:hover{background: rgba(255,45,45,.32); background-clip: padding-box}

.topbar{
  display:flex;
  gap:16px;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
}
.brand__title{
  font-weight:700;
  letter-spacing:.2px;
  display:flex;
  align-items:center;
  gap:10px;
}
.brand__icon{
  width:22px;
  height:22px;
  border-radius:6px;
  image-rendering: pixelated;
}
.brand__motto{
  margin-left:6px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  font-size:12px;
  color: var(--muted);
  white-space:nowrap;
}
.brand__subtitle{color:var(--muted); font-size:12px; margin-top:2px}
.topbar__actions{display:flex; gap:10px; align-items:center}
.themeDot{
  width:10px;
  height:10px;
  border-radius:999px;
  display:inline-block;
  background: var(--accent);
  box-shadow: 0 0 0 2px rgba(0,0,0,.25);
  margin-right:8px;
}
.themeText{font-weight:600}

.layout{
  display:grid;
  grid-template-columns: 360px 1fr 320px;
  min-height: calc(100vh - var(--topbar-h) - var(--statusbar-h));
  height: calc(100vh - var(--topbar-h) - var(--statusbar-h));
  overflow:hidden;
}
.panel{
  padding:14px;
  border-right:1px solid var(--border);
  background:var(--panel);
  overflow:auto;
}
.panel--right{
  border-right:none;
  border-left:1px solid var(--border);
  height: 100%;
}
.stage{
  padding:18px;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  overflow:auto;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
}
.card__head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.card__title{
  margin:0;
  font-size:13px;
  color:var(--muted);
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.08em;
}

.palette{
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  gap:8px;
}
.colorSlots{
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap:8px;
  margin-bottom:10px;
  min-width:0;
}
.slotBtn{
  height:38px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 10px;
  gap:10px;
  width:100%;
  max-width:100%;
  min-width:0;
}
.slotBtn[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.slotLbl{font-size:12px; font-weight:700; color:var(--muted); letter-spacing:.04em}
.slotSwatch{
  width:18px;
  height:18px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,.22);
  box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
  background:#000;
}
.swatch{
  width:100%;
  aspect-ratio: 1 / 1;
  border-radius:10px;
  padding:0;
  min-width:0;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 0 0 1px rgba(0,0,0,.2) inset;
  cursor:pointer;
  position:relative;
  outline:none;
}
.swatch[aria-checked="true"]{
  box-shadow: 0 0 0 2px var(--accent), 0 0 0 1px rgba(0,0,0,.2) inset;
  border-color: rgba(255,255,255,.28);
}

.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px}
.grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
.tools{display:grid; grid-template-columns: 1fr; gap:8px}
.field{display:flex; flex-direction:column; gap:6px}
.field__label{font-size:12px; color:var(--muted)}
.field__input{
  height:34px;
  padding:0 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  color:var(--text);
}
.field__input--color{
  padding:0;
  height:34px;
}
.toggle{
  display:flex;
  gap:10px;
  align-items:center;
  user-select:none;
  cursor:pointer;
  position:relative;
}
.toggle input{
  position:absolute;
  opacity:0;
  pointer-events:none;
}
.toggleBox{
  width:18px;
  height:18px;
  border-radius:8px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.04);
  display:inline-block;
  position:relative;
  flex:0 0 auto;
}
.toggle input:checked + .toggleBox{
  background: rgba(106,161,255,.22);
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.20) inset;
}
.toggleBox::after{
  content:"";
  position:absolute;
  inset:0;
  background: currentColor;
  clip-path: polygon(20% 55%, 38% 72%, 78% 28%, 86% 36%, 38% 82%, 14% 58%);
  color: rgba(255,255,255,.95);
  opacity:0;
}
.toggle input:checked + .toggleBox::after{opacity:1}
.toggle input:focus-visible + .toggleBox{
  outline: 2px solid rgba(106,161,255,.55);
  outline-offset: 2px;
}
.toggleText{font-size:13px; font-weight:600}
.toggleBtn{
  height:40px;
  padding:0 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  width:100%;
}
.toggleBtn:hover{border-color:#3a4770}
.toggleBtn .toggleText{font-weight:600}
.toggleBtn .toggleBox{margin-right:2px}

html[data-theme="dark"] .toggleBox{
  background: rgba(255,45,45,.06);
  border-color: rgba(255,45,45,.32);
}
html[data-theme="dark"] .toggle input:checked + .toggleBox{
  background: rgba(255,45,45,.18);
  border-color: rgba(255,45,45,.55);
  box-shadow: 0 0 0 1px rgba(255,45,45,.20) inset;
}
html[data-theme="dark"] .toggle input:focus-visible + .toggleBox{
  outline: 2px solid rgba(255,45,45,.55);
}
.hint{font-size:12px; color:var(--muted)}
.status{margin-top:10px; font-size:12px; color:var(--muted)}

.btn{
  height:34px;
  padding:0 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0f1421;
  color:var(--text);
  cursor:pointer;
  min-width:0;
}
.btn:hover{border-color:#3a4770}
.btn:active{transform: translateY(1px)}
.btn[disabled]{opacity:.55; cursor:not-allowed}
.srOnly{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip: rect(0, 0, 0, 0);
  white-space:nowrap;
  border:0;
}
.toolBtn[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.toolBtn{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:10px;
  padding:0 12px;
  height:40px;
}
.toolIcon{
  width:18px;
  height:18px;
  color: var(--text);
}
.toolText{
  font-size:13px;
  font-weight:600;
  letter-spacing:.2px;
}

.library{
  margin-top:10px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap:10px;
}
.libItem{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  border:1px solid var(--border);
  border-radius:12px;
  background:#0f1421;
  cursor:pointer;
  overflow:hidden;
}
.libItem:hover{border-color:#3a4770}
.libItem[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.libThumb{
  width:100%;
  height:84px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.12);
  background: repeating-conic-gradient(rgba(255,255,255,.06) 0 25%, rgba(255,255,255,0) 0 50%) 50% / 16px 16px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.libThumb canvas{
  max-width:100%;
  max-height:100%;
  width:auto;
  height:auto;
  image-rendering: pixelated;
  border-radius:10px;
}

.library--sprites .libItem--active{
  grid-column: 1 / -1;
}
.library--sprites .libItem--active .libThumb{
  height:140px;
}
.libRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  min-width:0;
}
.libMeta{
  font-size:11px;
  color:var(--muted);
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.libActions{display:flex; gap:8px; align-items:center; flex:0 0 auto}
.iconBtn{
  width:32px;
  height:32px;
  border-radius:10px;
  border:1px solid var(--border);
  background: rgba(15,20,33,.88);
  color: var(--text);
  cursor:pointer;
}
.iconBtn:hover{border-color:#3a4770}
.iconBtn svg{width:16px; height:16px; display:block; margin:0 auto; color:var(--text)}
.collapseBtn svg{transition: transform .12s ease}
.collapseBtn[aria-expanded="false"] svg{transform: rotate(-90deg)}
.btn--primary{
  background: linear-gradient(180deg, rgba(106,161,255,.24), rgba(106,161,255,.06));
  border-color: rgba(106,161,255,.35);
}
.btn--danger{
  background: linear-gradient(180deg, rgba(255,90,106,.18), rgba(255,90,106,.05));
  border-color: rgba(255,90,106,.35);
}

.canvasWrap{
  display:inline-block;
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  background:#0b0e16;
  outline:none;
  position:relative;
}

html[data-theme="dark"] .canvasWrap{
  cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><g transform='rotate(180 16 16)'><path d='M16 4 L23 26 L5.8 12.5 L26.2 12.5 L9 26 Z' fill='none' stroke='%23ff2d2d' stroke-width='1.8' stroke-linejoin='round'/><circle cx='16' cy='16' r='2' fill='%23ff2d2d'/></g></svg>") 16 16, crosshair;
}

html[data-theme="dark"] .canvasWrap{
  background: rgba(11,14,22,.18);
  border-color: rgba(255,45,45,.22);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.canvasWrap:focus{
  box-shadow: 0 0 0 2px rgba(106,161,255,.35);
}
canvas{
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  display:block;
  border-radius:10px;
}

.overlay{
  position:absolute;
  inset: 14px;
  pointer-events:none;
}
.overlayBar{
  position:absolute;
  display:flex;
  gap:8px;
  pointer-events:auto;
}
.overlayBar--top{left:50%; top:-10px; transform:translate(-50%,-100%)}
.overlayBar--bottom{left:50%; bottom:-10px; transform:translate(-50%,100%)}
.overlayBar--left{left:-10px; top:50%; transform:translate(-100%,-50%); flex-direction:column}
.overlayBar--right{right:-10px; top:50%; transform:translate(100%,-50%); flex-direction:column}
.overlayBtn{
  width:34px;
  height:34px;
  border-radius:10px;
  border:1px solid var(--border);
  background: rgba(15,20,33,.88);
  color: var(--text);
  cursor:pointer;
}
.overlayBtn:hover{border-color:#3a4770}
.overlayBtn[aria-pressed="true"]{
  border-color: rgba(106,161,255,.55);
  box-shadow: 0 0 0 1px rgba(106,161,255,.25) inset;
}
.overlayBtn svg{width:18px; height:18px; display:block; margin:0 auto; color:var(--text)}

.statusbar{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height: var(--statusbar-h);
  padding:10px 12px;
  border-top:1px solid var(--border);
  background: linear-gradient(180deg, rgba(15,17,21,0), rgba(15,17,21,.92) 30%, rgba(15,17,21,.98));
  backdrop-filter: blur(10px);
}
.statuscard{
  max-width: 1200px;
  margin: 0 auto;
  border:1px solid var(--border);
  border-radius:12px;
  background: rgba(26,32,48,.78);
}
.statusgrid{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:8px;
  padding:10px;
}
.kv{display:flex; flex-direction:column; gap:4px; min-width:0}
.k{font-size:11px; letter-spacing:.06em; text-transform:uppercase; color:var(--muted)}
.v{font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

@media (max-width: 980px){
  .layout{grid-template-columns:1fr}
  .panel{border-right:none; border-bottom:1px solid var(--border)}
  .panel--right{border-left:none; height:auto; overflow:visible}
  .statusgrid{grid-template-columns: 1fr 1fr}
}

/* Evil theme background */
.evilLayer{
  display:none;
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  overflow:hidden;
}
html[data-theme="dark"] .evilLayer{display:block}
.evilSigil{
  position:absolute;
  left:50%;
  top:46%;
  width:min(780px, 92vw);
  height:auto;
  transform: translate(-50%,-50%) rotateX(58deg) rotateZ(0deg);
  opacity:.55;
  filter: drop-shadow(0 0 24px rgba(255,45,45,.18));
  animation: sigilSpin 18s linear infinite;
}
@keyframes sigilSpin{
  from{transform: translate(-50%,-50%) rotateX(58deg) rotateZ(0deg)}
  to{transform: translate(-50%,-50%) rotateX(58deg) rotateZ(360deg)}
}
.evilFire{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  opacity:.75;
  mix-blend-mode: screen;
  filter: blur(.2px) saturate(1.2);
}
html[data-theme="dark"] body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  background: radial-gradient(1200px 700px at 50% 40%, rgba(255,45,45,.12), rgba(0,0,0,0) 60%),
              radial-gradient(900px 520px at 20% 10%, rgba(255,45,45,.06), rgba(0,0,0,0) 60%);
}
.topbar,.layout{position:relative; z-index:1}
.statusbar{z-index:2}

html[data-theme="dark"] .card{
  background: rgba(12,16,26,.30) !important;
}
html[data-theme="dark"] .statuscard{
  background: rgba(12,16,26,.30) !important;
}
html[data-theme="dark"] .statusgrid{
  background: rgba(0,0,0,0);
}
html[data-theme="dark"] .statusbar{
  background: linear-gradient(180deg, rgba(7,8,11,0), rgba(7,8,11,.45) 30%, rgba(7,8,11,.55));
}

/* Dark theme: kanciasty (bez zaokrągleń) */
html[data-theme="dark"] .card,
html[data-theme="dark"] .statuscard,
html[data-theme="dark"] .canvasWrap,
html[data-theme="dark"] canvas,
html[data-theme="dark"] .btn,
html[data-theme="dark"] .iconBtn,
html[data-theme="dark"] .overlayBtn,
html[data-theme="dark"] .swatch,
html[data-theme="dark"] .slotBtn,
html[data-theme="dark"] .slotSwatch,
html[data-theme="dark"] .toggleBox,
html[data-theme="dark"] .libItem,
html[data-theme="dark"] .libThumb,
html[data-theme="dark"] .field__input,
html[data-theme="dark"] .brand__icon,
html[data-theme="dark"] .brand__motto{
  border-radius: 0 !important;
}
.library--sprites{
  grid-template-columns: repeat(3, minmax(0, 1fr));
}
